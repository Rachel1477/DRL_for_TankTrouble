# Quick Start: RL Training Guide

## ğŸš€ ç«‹å³å¼€å§‹è®­ç»ƒ

### æ–¹å¼ 1: GUI è®­ç»ƒï¼ˆæ¨èè§‚çœ‹å­¦ä¹ è¿‡ç¨‹ï¼‰

```bash
cd /home/rachel/CLionProjects/DRL_for_TankTrouble/build
./TankTrouble
```

1. ç‚¹å‡»ç•Œé¢ä¸Šçš„ **"Agentè®­ç»ƒ"** æŒ‰é’®
2. è§‚å¯Ÿæ¸¸æˆçª—å£ä¸­ agent ä¸ SmithAI å¯¹æˆ˜
3. è§‚å¯Ÿç»ˆç«¯è¾“å‡ºçš„è®­ç»ƒæ—¥å¿—

### æ–¹å¼ 2: çº¯å‘½ä»¤è¡Œè®­ç»ƒï¼ˆæ›´å¿«ï¼‰

```bash
cd /home/rachel/CLionProjects/DRL_for_TankTrouble
conda activate RL
python python/test_env_standalone.py
```

---

## ğŸ“Š ç†è§£è®­ç»ƒæ—¥å¿—

### å®æ—¶æ­¥éª¤æ—¥å¿—
```
[AGENT] step=20 action=3 (python) r=0.005 dp=0.002 ap=0.004 sp=0 sc=-0.0005
```

- `step`: å½“å‰episodeçš„æ­¥æ•°
- `action`: 
  - 0=é™æ­¢, 1=å‰è¿›, 2=åé€€, 3=é¡ºæ—¶é’ˆè½¬, 4=é€†æ—¶é’ˆè½¬, 5=å°„å‡»
- `(python)`: ä½¿ç”¨Pythonç­–ç•¥ï¼ˆvs `(fallback)`=C++å¯å‘å¼ï¼‰
- `r`: æ€»å¥–åŠ±
- `dp`: è·ç¦»è¿›æ­¥å¥–åŠ±ï¼ˆé è¿‘æ•Œäºº +ï¼Œè¿œç¦» -ï¼‰
- `ap`: å¯¹å‡†è¿›æ­¥å¥–åŠ±ï¼ˆæ›´å¯¹å‡† +ï¼Œåç¦» -ï¼‰
- `sp`: è½¬åœˆæƒ©ç½šï¼ˆåŸåœ°æ‰“è½¬ä¼šè§¦å‘ -0.03ï¼‰
- `sc`: æ­¥éª¤æˆæœ¬ï¼ˆæ¯æ­¥ -0.0005ï¼‰

### Episode ç»“æŸæ—¥å¿—
```
[Episode 50] WON | Steps: 234 | Epsilon: 0.905 | Buffer: 11700
[Model saved to checkpoint_dqn_gui.pth]
```

- `WON`/`LOST`: å¯¹å±€ç»“æœ
- `Steps`: è¯¥å±€æŒç»­æ­¥æ•°
- `Epsilon`: å½“å‰æ¢ç´¢ç‡ï¼ˆ1.0=å®Œå…¨éšæœºï¼Œ0.01=å‡ ä¹åªåˆ©ç”¨ï¼‰
- `Buffer`: replay bufferä¸­çš„ç»éªŒæ•°é‡

---

## ğŸ“ˆ è®­ç»ƒé˜¶æ®µä¸é¢„æœŸè¡¨ç°

### é˜¶æ®µ 1: éšæœºæ¢ç´¢ (Episode 1-100)
**Epsilon**: 1.0 -> 0.81  
**é¢„æœŸèƒœç‡**: 20-30%  
**è¡Œä¸ºç‰¹å¾**:
- å¤§é‡éšæœºåŠ¨ä½œ
- ç»å¸¸æ’å¢™
- ä¹±å°„å­å¼¹

**ç›®æ ‡**: ç§¯ç´¯å¤šæ ·åŒ–ç»éªŒ

### é˜¶æ®µ 2: åˆæ­¥å­¦ä¹  (Episode 100-300)
**Epsilon**: 0.81 -> 0.43  
**é¢„æœŸèƒœç‡**: 30-45%  
**è¡Œä¸ºç‰¹å¾**:
- å¼€å§‹è¿½è¸ªæ•Œäºº
- å°è¯•ç„å‡†åå°„å‡»
- ä»æœ‰è¾ƒå¤šéšæœºæ¢ç´¢

**ç›®æ ‡**: å­¦ä¹ åŸºæœ¬ç­–ç•¥

### é˜¶æ®µ 3: ç­–ç•¥ä¼˜åŒ– (Episode 300-500)
**Epsilon**: 0.43 -> 0.05  
**é¢„æœŸèƒœç‡**: 45-60%  
**è¡Œä¸ºç‰¹å¾**:
- ä¸»åŠ¨æ¥è¿‘æ•Œäºº
- è¾ƒç²¾ç¡®çš„ç„å‡†
- å¼€å§‹èº²é¿å­å¼¹

**ç›®æ ‡**: ç²¾ç»†åŒ–è¡Œä¸º

### é˜¶æ®µ 4: ç¨³å®šæ”¶æ•› (Episode 500-1000)
**Epsilon**: 0.05 -> 0.01  
**é¢„æœŸèƒœç‡**: 60-75%  
**è¡Œä¸ºç‰¹å¾**:
- é«˜æ•ˆçš„è¿½è¸ªå’Œå°„å‡»
- çµæ´»çš„èµ°ä½å’Œèº²é¿
- æˆ˜æœ¯æ€§å†³ç­–

**ç›®æ ‡**: è¾¾åˆ°é«˜æ°´å¹³å¯¹æŠ—

### é˜¶æ®µ 5: æŒç»­ä¼˜åŒ– (Episode 1000+)
**Epsilon**: 0.01ï¼ˆå›ºå®šï¼‰  
**é¢„æœŸèƒœç‡**: 70-80%  
**è¡Œä¸ºç‰¹å¾**:
- æ¥è¿‘ SmithAI æ°´å¹³
- å¶å°”ä¼šå‘ç°åˆ›æ–°æ‰“æ³•

**æ³¨æ„**: SmithAI éå¸¸å¼ºï¼Œ80%èƒœç‡å·²æ˜¯ä¼˜ç§€æ°´å¹³ï¼

---

## ğŸ¯ å¥–åŠ±æœºåˆ¶è¯¦è§£

### ç»ˆå±€å¥–åŠ±
- ğŸ’š **èƒœåˆ©**: +100
- â¤ï¸ **å¤±è´¥**: -100
- ğŸ’› **å¹³å±€**: 0

### è¿‡ç¨‹å¥–åŠ±ï¼ˆæ¯æ­¥ï¼‰

| è¡Œä¸º | å¥–åŠ±å€¼ | è§¦å‘æ¡ä»¶ |
|------|--------|----------|
| é è¿‘æ•Œäºº | +0.8 Ã— Î”dist | è·ç¦»å‡å°‘ |
| è¿œç¦»æ•Œäºº | -0.8 Ã— Î”dist | è·ç¦»å¢åŠ  |
| å¯¹å‡†æ•Œäºº | +0.15 Ã— Î”angle | è§’åº¦åå·®å‡å° |
| åç¦»æ•Œäºº | -0.15 Ã— Î”angle | è§’åº¦åå·®å¢å¤§ |
| ç²¾ç¡®å°„å‡» | +2.0 | åœ¨18åº¦å†…å°„å‡» |
| ä¸€èˆ¬å°„å‡» | +0.5 | åœ¨18-54åº¦å†…å°„å‡» |
| æµªè´¹å¼¹è¯ | -0.5 | åå·®>54åº¦è¿˜å°„å‡» |
| èº²é¿å­å¼¹ | +0.1 | è¿œç¦»é™„è¿‘å­å¼¹ |
| é è¿‘å­å¼¹ | -0.1 | æ¥è¿‘é™„è¿‘å­å¼¹ |
| åŸåœ°æ‰“è½¬ | -0.03 | ç§»åŠ¨<1åƒç´ ä½†è½¬>5åº¦ |
| æ­¥éª¤æˆæœ¬ | -0.0005 | æ¯æ­¥éƒ½æœ‰ |

---

## ğŸ›  è°ƒä¼˜å»ºè®®

### Agent ä¸å°„å‡»ï¼Ÿ
```python
# åœ¨ rl/TankEnv.cc ä¸­å¢åŠ å°„å‡»å¥–åŠ±
if(align_norm < 0.1)
    r += 3.0;  // ä» 2.0 å¢åŠ åˆ° 3.0
```

### Agent ä¸€ç›´è¾“ï¼Ÿ
1. **æ£€æŸ¥ buffer å¢é•¿**: å¦‚æœ buffer ä¸å¢é•¿ï¼Œè¯´æ˜step callbackæœªå·¥ä½œ
2. **å¢åŠ æ¢ç´¢**: å»¶é•¿ epsilon > 0.1 çš„å±€æ•°åˆ° 800 å±€
3. **é™ä½å­¦ä¹ ç‡**: åœ¨ `initialize_agent` ä¸­è®¾ç½® `lr=1e-4`

### è®­ç»ƒå¤ªæ…¢ï¼Ÿ
1. **å‡å°‘æ—¥å¿—**: ä¿®æ”¹ `step_count % 50 == 0` (åªæ‰“å°æ¯50æ­¥)
2. **å¢å¤§ batch_size**: 64 -> 128
3. **ä½¿ç”¨ GPU**: ç§»é™¤ `CUDA_VISIBLE_DEVICES` é™åˆ¶

### Agent è¡Œä¸ºå¼‚å¸¸ï¼Ÿ
```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
python python/test_state_info.py

# æµ‹è¯•éGUIç¯å¢ƒ
python python/test_env_standalone.py
```

---

## ğŸ’¾ æ¨¡å‹ç®¡ç†

### ä¿å­˜ä½ç½®
- **GUIè®­ç»ƒ**: `checkpoint_dqn_gui.pth`
- **ç‹¬ç«‹è®­ç»ƒ**: `saved_models/dqn_agent_episode_XXX.pth`

### åŠ è½½å·²æœ‰æ¨¡å‹ç»§ç»­è®­ç»ƒ
```python
# åœ¨ python/train_with_gui.py çš„ initialize_agent() ä¸­
# æ¨¡å‹ä¼šè‡ªåŠ¨åŠ è½½ checkpoint_dqn_gui.pth å¦‚æœå­˜åœ¨
```

### ä»å¤´å¼€å§‹è®­ç»ƒ
```bash
rm checkpoint_dqn_gui.pth  # åˆ é™¤æ—§æ¨¡å‹
./TankTrouble              # é‡æ–°è®­ç»ƒ
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ˜¾ç¤º `(fallback)` è€Œä¸æ˜¯ `(python)`ï¼Ÿ
A: Python å›è°ƒæœªæˆåŠŸæ³¨å…¥ã€‚æ£€æŸ¥ï¼š
```bash
# ç¡®è®¤ conda ç¯å¢ƒæ¿€æ´»
conda activate RL

# ç¡®è®¤ Python æ¨¡å—å¯å¯¼å…¥
python -c "from train_with_gui import initialize_agent; print('OK')"
```

### Q: æŠ¥é”™ "Unable to cast Python instance..."ï¼Ÿ
A: GIL ç®¡ç†é—®é¢˜ã€‚å·²åœ¨æœ€æ–°ä»£ç ä¸­ä¿®å¤ï¼Œé‡æ–°ç¼–è¯‘ï¼š
```bash
cd build && make clean && make -j$(nproc)
```

### Q: Agent è¡ŒåŠ¨ä½†æ²¡æœ‰å­¦ä¹ ï¼ˆèƒœç‡ä¸æå‡ï¼‰ï¼Ÿ
A: æ£€æŸ¥ episode_end æ—¥å¿—ä¸­çš„ `Buffer` æ•°å€¼ã€‚å¦‚æœä¸å¢é•¿ï¼š
1. step callback å¯èƒ½æœªæ³¨å…¥
2. æ£€æŸ¥ Window.cc ä¸­æ˜¯å¦è°ƒç”¨äº† `setStepCallback`

### Q: æŠ¥é”™ "mat1 and mat2 shapes cannot be multiplied"ï¼Ÿ
A: çŠ¶æ€ç»´åº¦ä¸åŒ¹é…ã€‚ç¡®è®¤ï¼š
```python
# åº”è¯¥è¾“å‡º 57
python -c "import tank_trouble_env; env = tank_trouble_env.TankEnv(); print(len(env.reset()))"
```

---

## ğŸ“š è¿›é˜¶é˜…è¯»

- `RL_IMPROVEMENTS_SUMMARY.md`: è¯¦ç»†çš„æ”¹è¿›è¯´æ˜
- `RL_TRAINING_GUIDE.md`: å®Œæ•´çš„è®­ç»ƒæ¡†æ¶æ–‡æ¡£
- `python/train_dqn.py`: DQN ç®—æ³•å®ç°
- `rl/TankEnv.cc`: å¥–åŠ±å‡½æ•°å®šä¹‰

---

## ğŸ® å¼€å§‹ä½ çš„è®­ç»ƒä¹‹æ—…ï¼

```bash
cd /home/rachel/CLionProjects/DRL_for_TankTrouble/build
./TankTrouble
# ç‚¹å‡» "Agentè®­ç»ƒ"
# è§‚å¯Ÿ Agent ä»èœé¸Ÿæˆé•¿ä¸ºé«˜æ‰‹ï¼
```

**é¢„è®¡æ—¶é—´**: 
- çœ‹åˆ°æ˜æ˜¾æ”¹è¿›ï¼š~200 episodes (~30åˆ†é’Ÿ)
- è¾¾åˆ°50%èƒœç‡ï¼š~500 episodes (~2å°æ—¶)
- æ¥è¿‘æœ€ä¼˜ï¼š~1000+ episodes (~4-6å°æ—¶)

ç¥è®­ç»ƒé¡ºåˆ©ï¼ğŸš€

